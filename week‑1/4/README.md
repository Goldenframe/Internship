# Нетворкинг

## Задание

Клиент-серверное взаимодействие. Протокол HTTP, архитектурный стиль REST и понимание его принципов. Имитация двухстороннего взаимодействия между клиентом и сервером (Long Polling, Short Polling). Полноценное двухстороннее взаимодействие (WebSocket).

## Клиент-серверное взаимодействие

Клиент-сервер - это способ общения между двумя сторонами: клиентом и сервером. Клиент (например, браузер, мобильное приложение или другая программа) просит что-то у сервера - информацию, данные или какие-то действия. Сервер обрабатывает этот запрос и отвечает.

### Как это работает:

1. Клиент отправляет запрос

2. Сервер получает запрос, обрабатывает его

3. Сервер отправляет ответ

### Существуют два основных типа взаимодействия:

- Stateless (без состояния) - каждый запрос живёт сам по себе. Сервер не помнит, что ты делал до этого. Типичный пример - обычный HTTP-запрос

- Stateful (с состоянием) - сервер что-то запоминает между запросами. Это бывает, например, при использовании сессий или WebSocket (постоянное соединение, как в онлайн-чатах)

### Есть разные подходы к построению API:

- REST - представление ресурсов (данных, объектов) через унифицированные интерфейсы, что упрощает взаимодействие между клиентами и серверами

- GraphQL - позволяет клиенту запрашивать только нужные данные
    
- SOAP - основан на протоколе SOAP (Simple Object Access Protocol). В отличие от REST, SOAP следует строгому процессу стандартизации, определяющему форматирование и передачу сообщений

- gRPC - супербыстрый, но сложнее, часто используется внутри крупных систем.

## Протокол HTTP

HTTP - это основной протокол, разработанный для обмена данными между клиентом и сервером 

### Основные особенности:

- Текстовый - запросы и ответы можно прочитать (в отличие от бинарных протоколов)

- Клиент-серверный - клиент запрашивает, сервер отвечает

- Stateless - сам по себе HTTP ничего не помнит. Каждый запрос как в первый раз. Чтобы "запомнить" пользователя, используются куки, сессии и токены

### Как выглядит HTTP-запрос:

Состоит из трёх частей:

1. Стартовая строка - метод (например, GET) + путь (URL) + версия протокола (HTTP/1.1)

2. Заголовки (необязательно) - дополнительная информация (например, User-Agent, Accept, Authorization)

3. Тело запроса (необязательно)- используется, например, в POST для передачи данных (форма, JSON и т.д.)

### HTTP-ответ от сервера:

Тоже делится на:
1. Статусная строка - код ответа (200 OK, 404 Not Found, 500 Internal Server Error и др.)

2. Заголовки (необязательно) - например, Content-Type: text/html

3. Тело ответа - сам HTML, JSON, картинка и т.д.

### Основные методы HTTP:

- GET - получить данные (например, веб-страницу)

- POST - отправить данные на сервер (например, форму регистрации)

- PUT - обновить ресурс

- DELETE - удалить ресурс

- PATCH - частичное обновление

- HEAD, OPTIONS - вспомогательные

### HTTP vs HTTPS:

- HTTP - работает без шифрования (уязвим к перехвату)

- HTTPS - то же самое, но через шифрованный канал (SSL/TLS), безопасно

## Архитектурный стиль REST и понимание его принципов

REST (Representational State Transfer) - это архитектурный стиль, по которому строятся современные API . REST не протокол, а набор правил, как должен выглядеть и работать API, чтобы с ним было удобно и понятно взаимодействовать.


### Основные принципы REST:

1. Клиент-сервер
Клиенти сервер работают независимо. Клиент делает запросы, сервер отвечает. Они развиваются отдельно и не зависят друг от друга напрямую

2. Stateless
Каждый запрос от клиента к серверу должен содержать всю нужную информацию. Сервер не должен "помнить", что было раньше 

3. Кеширование
Ответы можно кешировать, чтобы не число запросов не так сильно росло 

4. Единый интерфейс
Все взаимодействия происходят через один и тот же механизм (обычно HTTP и URL)

5. Иерархия ресурсов через URL
В REST каждый элемент - это ресурс, и у него есть свой адрес

6. Код по требованию (необязательно)
Этот принцип означает, что сервер в ответ на запрос может отправить исходный код, который выполняется уже на стороне клиента. Благодаря этому можно передавать целые сценарии. Например, динамические элементы пользовательского интерфейса, написанные на JavaScript.
В REST API требование необязательно, потому что не всем сайтам и сервисам нужно умение работать с готовыми скриптами.


## Short Polling

Это метод опроса сервера, при котором клиент периодически отправляет запросы для проверки обновлений или новых данных. В отличие от постоянного соединения, клиент инициирует запросы через заданные интервалы, например, каждую секунду или каждые несколько секунд. 

### Преимущества:

- Простая реализация, подходит для приложений, где данные обновляются редко

### Недостатки:

- Высокая нагрузка на сервер и сеть из-за частых запросов, даже если данные не изменились

- Может приводить к задержкам в получении данных, так как обновления видны только при очередном запросе

Пример: чат, где каждую секунду клиент отправляет GET /messages - и сервер либо отдаёт новые сообщения, либо пусто

## Long Polling

это метод опроса сервера, при котором клиент отправляет запрос и остается подключенным к серверу, ожидая ответа до тех пор, пока не появятся новые данные. Если серверу нечего отправить, он удерживает запрос открытым, пока не произойдет обновление, или пока не истечет тайм-аут. После получения ответа клиент сразу отправляет новый запрос для продолжения ожидания.

### Преимущества:

1. Меньше нагрузка на сервер по сравнению с Short polling, так как запросы отправляются реже, только когда есть новые данные

2. Обеспечивает более оперативное получение обновлений, чем при обычном коротком опросе

### Недостатки:

1. Задержка может быть непредсказуемой, особенно если данные появляются нерегулярно

2. Удержание открытого соединения может быть менее эффективным для серверов с ограниченными ресурсами, особенно при большом количестве клиентов


## Полноценное двустороннее взаимодействие (WebSocket)

WebSocket - это технология, которая позволяет клиенту и серверу общаться между собой в обе стороны в реальном времени. В отличие от обычного HTTP, где клиент что-то запрашивает, а сервер просто отвечает, здесь создаётся постоянное соединение. После установки связи данные могут свободно «летать» туда и обратно без дополнительных запросов.

###  Как это работает:

1. Клиент отправляет обычный HTTP-запрос с просьбой перейти на WebSocket-соединение

2. Сервер 'соглашается', и соединение превращается в постоянный канал связи

3. После этого нет необходимости каждый раз открывать новое соединение


### Преимущества WebSocket:

1. Реальное двустороннее общение между клиентом и сервером

2. Минимальные задержки при передаче данных

3. Нет необходимости в постоянных повторных запросах, как при polling

4. Меньшая нагрузка на сеть и сервер из-за постоянного соединения

### Недостатки WebSocket:

1. Более сложная реализация по сравнению с обычным HTTP: нужно следить за соединениями, пинговать клиентов, обрабатывать обрывы связи

2. Требует дополнительных мер безопасности (особенно при использовании ws:// без шифрования)

3. Не во всех случаях целесообразен 

Каналы WebSocket имеют специальные адреса: ws:// для обычных соединений и wss:// - для защищённых, аналогично HTTP и HTTPS
