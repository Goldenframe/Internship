# Теория безопасности

### Простые запросы

Браузер может отправить запрос сразу, без дополнительных проверок, если запрос достаточно безопасный, а именно:

* метод запроса — `GET`, `POST`
* в запросе нет дополнительных заголовков и `Authorization`


### Preflight-запрос

Если запрос более сложный (например, `PATCH`, `PUT`, `DELETE` или содержит нестандартные заголовки), браузер сначала отправляет вспомогательный запрос `OPTIONS`, чтобы уточнить у сервера, разрешён ли такой запрос

Важные заголовки preflight запроса и ответа сервера

В preflight запросе используются следующие ключевые заголовки:

* Access-Control-Request-Method: сообщает серверу, какой HTTP метод будет использоваться в основном запросе.
* Access-Control-Request-Headers: перечисляет заголовки, которые будут использоваться в основном запросе.
* Origin: указывает домен, с которого был сделан запрос.

Ответ сервера на preflight запрос может включать:

* Access-Control-Allow-Origin: указывает, какие домены могут получать ответы.
* Access-Control-Allow-Methods: перечисляет методы, разрешенные для кросс-доменных запросов.
* Access-Control-Allow-Headers: указывает, какие заголовки разрешены в запросе.
* Access-Control-Max-Age: сообщает, как долго результат preflight запроса может быть кэширован.


## XSS (Cross-Site Scripting)

**Что это такое:** злоумышленник внедряет на сайт кусок JavaScript-кода, который выполняется у пользователя в браузере

**Чем опасно:**

* могут украсть cookies, токены или личные данные
* могут изменить содержимое страницы
* могут выполнять действия от лица пользователя

**Как защититься:**

* экранировать данные перед выводом (`<` → `&lt;`, `>` → `&gt;`);
* включать Content Security Policy (CSP)


## CSRF (Cross-Site Request Forgery)

**Что это такое:** атака, при которой пользователь невольно отправляет запрос на доверенный сайт (например, на банк), и браузер автоматически прикладывает cookies или токен

**Как защититься:**

* использовать CSRF-токены (уникальные значения в формах и запросах)
* проверять заголовки `Origin` или `Referer`
* использовать `SameSite` для cookies

## Защита API

1. **Аутентификация и авторизация**

   * использовать токены (JWT, например), а не cookies
   * задавать ограниченный срок жизни токенов
   * давать пользователям только те права, которые им реально нужны

2. **Передача данных**

   * всегда использовать HTTPS
   * хранить пароли только в зашифрованном виде (например, через `bcrypt`)
   * использовать `.env`

3. **Ограничение запросов**

   * ограничивать количество запросов с одного IP

4. **CORS**

   * разрешать запросы только с нужных доменов, а не со всех (`*`)
   * указывать только необходимые методы и заголовки

